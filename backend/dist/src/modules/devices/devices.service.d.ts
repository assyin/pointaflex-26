import { PrismaService } from 'src/database/prisma.service';
import { CreateDeviceDto } from './dto/create-device.dto';
import { UpdateDeviceDto } from './dto/update-device.dto';
import { DeviceAction } from '@prisma/client';
export interface AuditContext {
    userId?: string;
    userName?: string;
    ipAddress?: string;
    userAgent?: string;
}
export declare class DevicesService {
    private prisma;
    private readonly SALT_ROUNDS;
    private readonly API_KEY_EXPIRY_DAYS;
    constructor(prisma: PrismaService);
    private createAuditLog;
    private generateApiKey;
    verifyApiKey(deviceId: string, tenantId: string, apiKey: string): Promise<boolean>;
    generateNewApiKey(id: string, tenantId: string, context: AuditContext): Promise<{
        apiKey: string;
        expiresAt: Date;
    }>;
    rotateApiKey(id: string, tenantId: string, context: AuditContext): Promise<{
        apiKey: string;
        expiresAt: Date;
    }>;
    revokeApiKey(id: string, tenantId: string, context: AuditContext): Promise<void>;
    verifyIPWhitelist(deviceId: string, tenantId: string, clientIP: string): Promise<boolean>;
    updateIPWhitelist(id: string, tenantId: string, allowedIPs: string[], enforceIPWhitelist: boolean, context: AuditContext): Promise<{
        site: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            phone: string | null;
            address: string | null;
            timezone: string | null;
            city: string | null;
            tenantId: string;
            code: string | null;
            name: string;
            departmentId: string | null;
            managerId: string | null;
            latitude: import("@prisma/client/runtime/library").Decimal | null;
            longitude: import("@prisma/client/runtime/library").Decimal | null;
            workingDays: import("@prisma/client/runtime/library").JsonValue | null;
        };
    } & {
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        name: string;
        isActive: boolean;
        siteId: string | null;
        deviceId: string;
        ipAddress: string | null;
        deviceType: import(".prisma/client").$Enums.DeviceType;
        apiKey: string | null;
        apiKeyHash: string | null;
        apiKeyLastRotation: Date | null;
        apiKeyExpiresAt: Date | null;
        allowedIPs: string[];
        enforceIPWhitelist: boolean;
        lastSync: Date | null;
        lastHeartbeat: Date | null;
        heartbeatInterval: number;
        totalSyncs: number;
        failedSyncs: number;
        avgResponseTime: number | null;
    }>;
    recordHeartbeat(deviceId: string, tenantId: string, clientIP?: string): Promise<{
        status: string;
        serverTime: Date;
        nextHeartbeatExpected: Date;
    }>;
    getConnectionStatus(device: any): 'ONLINE' | 'WARNING' | 'OFFLINE' | 'INACTIVE';
    create(tenantId: string, createDeviceDto: CreateDeviceDto, context?: AuditContext): Promise<{
        generatedApiKey: string;
        site: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            phone: string | null;
            address: string | null;
            timezone: string | null;
            city: string | null;
            tenantId: string;
            code: string | null;
            name: string;
            departmentId: string | null;
            managerId: string | null;
            latitude: import("@prisma/client/runtime/library").Decimal | null;
            longitude: import("@prisma/client/runtime/library").Decimal | null;
            workingDays: import("@prisma/client/runtime/library").JsonValue | null;
        };
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        name: string;
        isActive: boolean;
        siteId: string | null;
        deviceId: string;
        ipAddress: string | null;
        deviceType: import(".prisma/client").$Enums.DeviceType;
        apiKey: string | null;
        apiKeyHash: string | null;
        apiKeyLastRotation: Date | null;
        apiKeyExpiresAt: Date | null;
        allowedIPs: string[];
        enforceIPWhitelist: boolean;
        lastSync: Date | null;
        lastHeartbeat: Date | null;
        heartbeatInterval: number;
        totalSyncs: number;
        failedSyncs: number;
        avgResponseTime: number | null;
    }>;
    findAll(tenantId: string, filters?: any): Promise<{
        connectionStatus: "WARNING" | "ONLINE" | "OFFLINE" | "INACTIVE";
        hasApiKey: boolean;
        apiKeyExpired: boolean;
        _count: {
            attendance: number;
        };
        site: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            phone: string | null;
            address: string | null;
            timezone: string | null;
            city: string | null;
            tenantId: string;
            code: string | null;
            name: string;
            departmentId: string | null;
            managerId: string | null;
            latitude: import("@prisma/client/runtime/library").Decimal | null;
            longitude: import("@prisma/client/runtime/library").Decimal | null;
            workingDays: import("@prisma/client/runtime/library").JsonValue | null;
        };
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        name: string;
        isActive: boolean;
        siteId: string | null;
        deviceId: string;
        ipAddress: string | null;
        deviceType: import(".prisma/client").$Enums.DeviceType;
        apiKey: string | null;
        apiKeyHash: string | null;
        apiKeyLastRotation: Date | null;
        apiKeyExpiresAt: Date | null;
        allowedIPs: string[];
        enforceIPWhitelist: boolean;
        lastSync: Date | null;
        lastHeartbeat: Date | null;
        heartbeatInterval: number;
        totalSyncs: number;
        failedSyncs: number;
        avgResponseTime: number | null;
    }[]>;
    findOne(id: string, tenantId: string): Promise<{
        connectionStatus: "WARNING" | "ONLINE" | "OFFLINE" | "INACTIVE";
        hasApiKey: boolean;
        apiKeyExpired: boolean;
        _count: {
            attendance: number;
            auditLogs: number;
        };
        site: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            phone: string | null;
            address: string | null;
            timezone: string | null;
            city: string | null;
            tenantId: string;
            code: string | null;
            name: string;
            departmentId: string | null;
            managerId: string | null;
            latitude: import("@prisma/client/runtime/library").Decimal | null;
            longitude: import("@prisma/client/runtime/library").Decimal | null;
            workingDays: import("@prisma/client/runtime/library").JsonValue | null;
        };
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        name: string;
        isActive: boolean;
        siteId: string | null;
        deviceId: string;
        ipAddress: string | null;
        deviceType: import(".prisma/client").$Enums.DeviceType;
        apiKey: string | null;
        apiKeyHash: string | null;
        apiKeyLastRotation: Date | null;
        apiKeyExpiresAt: Date | null;
        allowedIPs: string[];
        enforceIPWhitelist: boolean;
        lastSync: Date | null;
        lastHeartbeat: Date | null;
        heartbeatInterval: number;
        totalSyncs: number;
        failedSyncs: number;
        avgResponseTime: number | null;
    }>;
    findByDeviceId(deviceId: string, tenantId: string): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        name: string;
        isActive: boolean;
        siteId: string | null;
        deviceId: string;
        ipAddress: string | null;
        deviceType: import(".prisma/client").$Enums.DeviceType;
        apiKey: string | null;
        apiKeyHash: string | null;
        apiKeyLastRotation: Date | null;
        apiKeyExpiresAt: Date | null;
        allowedIPs: string[];
        enforceIPWhitelist: boolean;
        lastSync: Date | null;
        lastHeartbeat: Date | null;
        heartbeatInterval: number;
        totalSyncs: number;
        failedSyncs: number;
        avgResponseTime: number | null;
    }>;
    update(id: string, tenantId: string, updateDeviceDto: UpdateDeviceDto, context?: AuditContext): Promise<{
        connectionStatus: "WARNING" | "ONLINE" | "OFFLINE" | "INACTIVE";
        site: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            phone: string | null;
            address: string | null;
            timezone: string | null;
            city: string | null;
            tenantId: string;
            code: string | null;
            name: string;
            departmentId: string | null;
            managerId: string | null;
            latitude: import("@prisma/client/runtime/library").Decimal | null;
            longitude: import("@prisma/client/runtime/library").Decimal | null;
            workingDays: import("@prisma/client/runtime/library").JsonValue | null;
        };
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        name: string;
        isActive: boolean;
        siteId: string | null;
        deviceId: string;
        ipAddress: string | null;
        deviceType: import(".prisma/client").$Enums.DeviceType;
        apiKey: string | null;
        apiKeyHash: string | null;
        apiKeyLastRotation: Date | null;
        apiKeyExpiresAt: Date | null;
        allowedIPs: string[];
        enforceIPWhitelist: boolean;
        lastSync: Date | null;
        lastHeartbeat: Date | null;
        heartbeatInterval: number;
        totalSyncs: number;
        failedSyncs: number;
        avgResponseTime: number | null;
    }>;
    remove(id: string, tenantId: string, context?: AuditContext): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        name: string;
        isActive: boolean;
        siteId: string | null;
        deviceId: string;
        ipAddress: string | null;
        deviceType: import(".prisma/client").$Enums.DeviceType;
        apiKey: string | null;
        apiKeyHash: string | null;
        apiKeyLastRotation: Date | null;
        apiKeyExpiresAt: Date | null;
        allowedIPs: string[];
        enforceIPWhitelist: boolean;
        lastSync: Date | null;
        lastHeartbeat: Date | null;
        heartbeatInterval: number;
        totalSyncs: number;
        failedSyncs: number;
        avgResponseTime: number | null;
    }>;
    getStats(tenantId: string): Promise<{
        total: number;
        online: number;
        warning: number;
        offline: number;
        inactive: number;
        active: number;
        apiKeyExpiringSoon: number;
    }>;
    syncDevice(id: string, tenantId: string, context?: AuditContext): Promise<{
        success: boolean;
        message: string;
        device: {
            connectionStatus: "WARNING" | "ONLINE" | "OFFLINE" | "INACTIVE";
            site: {
                id: string;
                createdAt: Date;
                updatedAt: Date;
                phone: string | null;
                address: string | null;
                timezone: string | null;
                city: string | null;
                tenantId: string;
                code: string | null;
                name: string;
                departmentId: string | null;
                managerId: string | null;
                latitude: import("@prisma/client/runtime/library").Decimal | null;
                longitude: import("@prisma/client/runtime/library").Decimal | null;
                workingDays: import("@prisma/client/runtime/library").JsonValue | null;
            };
            id: string;
            createdAt: Date;
            updatedAt: Date;
            tenantId: string;
            name: string;
            isActive: boolean;
            siteId: string | null;
            deviceId: string;
            ipAddress: string | null;
            deviceType: import(".prisma/client").$Enums.DeviceType;
            apiKey: string | null;
            apiKeyHash: string | null;
            apiKeyLastRotation: Date | null;
            apiKeyExpiresAt: Date | null;
            allowedIPs: string[];
            enforceIPWhitelist: boolean;
            lastSync: Date | null;
            lastHeartbeat: Date | null;
            heartbeatInterval: number;
            totalSyncs: number;
            failedSyncs: number;
            avgResponseTime: number | null;
        };
    }>;
    activateDevice(id: string, tenantId: string, context: AuditContext): Promise<{
        connectionStatus: "WARNING" | "ONLINE" | "OFFLINE" | "INACTIVE";
        site: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            phone: string | null;
            address: string | null;
            timezone: string | null;
            city: string | null;
            tenantId: string;
            code: string | null;
            name: string;
            departmentId: string | null;
            managerId: string | null;
            latitude: import("@prisma/client/runtime/library").Decimal | null;
            longitude: import("@prisma/client/runtime/library").Decimal | null;
            workingDays: import("@prisma/client/runtime/library").JsonValue | null;
        };
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        name: string;
        isActive: boolean;
        siteId: string | null;
        deviceId: string;
        ipAddress: string | null;
        deviceType: import(".prisma/client").$Enums.DeviceType;
        apiKey: string | null;
        apiKeyHash: string | null;
        apiKeyLastRotation: Date | null;
        apiKeyExpiresAt: Date | null;
        allowedIPs: string[];
        enforceIPWhitelist: boolean;
        lastSync: Date | null;
        lastHeartbeat: Date | null;
        heartbeatInterval: number;
        totalSyncs: number;
        failedSyncs: number;
        avgResponseTime: number | null;
    }>;
    deactivateDevice(id: string, tenantId: string, context: AuditContext): Promise<{
        connectionStatus: "WARNING" | "ONLINE" | "OFFLINE" | "INACTIVE";
        site: {
            id: string;
            createdAt: Date;
            updatedAt: Date;
            phone: string | null;
            address: string | null;
            timezone: string | null;
            city: string | null;
            tenantId: string;
            code: string | null;
            name: string;
            departmentId: string | null;
            managerId: string | null;
            latitude: import("@prisma/client/runtime/library").Decimal | null;
            longitude: import("@prisma/client/runtime/library").Decimal | null;
            workingDays: import("@prisma/client/runtime/library").JsonValue | null;
        };
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        name: string;
        isActive: boolean;
        siteId: string | null;
        deviceId: string;
        ipAddress: string | null;
        deviceType: import(".prisma/client").$Enums.DeviceType;
        apiKey: string | null;
        apiKeyHash: string | null;
        apiKeyLastRotation: Date | null;
        apiKeyExpiresAt: Date | null;
        allowedIPs: string[];
        enforceIPWhitelist: boolean;
        lastSync: Date | null;
        lastHeartbeat: Date | null;
        heartbeatInterval: number;
        totalSyncs: number;
        failedSyncs: number;
        avgResponseTime: number | null;
    }>;
    getAuditLogs(tenantId: string, filters?: {
        deviceId?: string;
        action?: DeviceAction;
        performedBy?: string;
        startDate?: string | Date;
        endDate?: string | Date;
        page?: number;
        limit?: number;
    }): Promise<{
        data: ({
            device: {
                name: string;
                deviceId: string;
            };
        } & {
            id: string;
            createdAt: Date;
            tenantId: string;
            deviceId: string;
            ipAddress: string | null;
            userAgent: string | null;
            action: import(".prisma/client").$Enums.DeviceAction;
            details: import("@prisma/client/runtime/library").JsonValue | null;
            performedBy: string | null;
            performedByName: string | null;
            previousValue: import("@prisma/client/runtime/library").JsonValue | null;
            newValue: import("@prisma/client/runtime/library").JsonValue | null;
        })[];
        meta: {
            total: number;
            page: number;
            limit: number;
            totalPages: number;
        };
    }>;
}
